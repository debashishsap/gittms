name: Deploy to Cloud TMS
on:
  push:
    branches:
    - main
jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
        - name: Use Node.js
          uses: actions/setup-node@v2
          with:
            node-version: 16
        - name: Extract branch name
          shell: bash
          run: |
            echo "branch=${GITHUB_HEAD_REF}"
            echo "${GITHUB_REF#refs/heads/}"
            echo "branch=${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}" >> $GITHUB_OUTPUT
            echo ${{ github.workspace }}
          id: extract_branch 
        - name: CURL
          run: |
            curl -V
          # TOKEN=$(curl -s -X POST -u "sb-d7d48e38-4683-463a-a607-4949e6146ca1!b153390|alm-ts-backend!b1603:0b907e0a-0b16-4130-85b0-db2eea982c4e$IJf4Vk4IBnvrrrpc4hvXn6WYG4NYAaAXofGQig-NbC4=" -d "grant_type=client_credentials&response_type=token" https://96468441trial.authentication.us10.hana.ondemand.com/oauth/token | sed -n '/ *"access_token": *"/ {s///; s/{//g ;s/".*//; p; }')                  
#TOKEN=$(curl -XPOST -H 'Accept: application/json' -u 'sb-21afe38d-ae8b-4d6f-9414-e352853ddf0e!b185374|alm-ts-backend!b1603:73a7dbc1-3dd5-4c67-a2f1-1d234a84f8ba$MFgjO37Ff6mErxiJNowC_k9T52qcUA5BmthRHDkfvNA=' -H 'Content-Type: application/x-www-form-urlencoded' 'https://70f0e8b1trial.authentication.us10.hana.ondemand.com/oauth/token?grant_type=client_credentials&response_type=token' | sed -n '/ *"access_token": *"/ {s///; s/{//g ;s/".*//; p; }')
        - name: Token
          run: |        
           TOKEN=$(curl -XPOST -H 'Set-Cookie: Cookie' -H 'Accept: application/json' -u 'sb-21afe38d-ae8b-4d6f-9414-e352853ddf0e!b185374|alm-ts-backend!b1603:73a7dbc1-3dd5-4c67-a2f1-1d234a84f8ba$MFgjO37Ff6mErxiJNowC_k9T52qcUA5BmthRHDkfvNA=' -H 'Content-Type: application/x-www-form-urlencoded' 'https://70f0e8b1trial.authentication.us10.hana.ondemand.com/oauth/token?grant_type=client_credentials&response_type=token' | sed -n '/ *"access_token": *"/ {s///; s/{//g ;s/".*//; p; }')
           echo $TOKEN
           BODY=$(curl -s --location --request POST 'https://70f0e8b1trial.authentication.us10.hana.ondemand.com/v2/files/upload' --header "Authorization: Bearer eyJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vNzBmMGU4YjF0cmlhbC5hdXRoZW50aWNhdGlvbi51czEwLmhhbmEub25kZW1hbmQuY29tL3Rva2VuX2tleXMiLCJraWQiOiJkZWZhdWx0LWp3dC1rZXktMTgyODE1MDA5IiwidHlwIjoiSldUIiwiamlkIjogIkFLM1U5dVdTVUtWMVU4SGJKVURnWjFpaHlVcnRVeG9WektTbWpSNUxwSkE9In0.eyJqdGkiOiI4N2M5MGE0OTZlOWI0MmRmODJjOGMwMzBmNmZhNTBmMCIsImV4dF9hdHRyIjp7ImVuaGFuY2VyIjoiWFNVQUEiLCJzdWJhY2NvdW50aWQiOiIyZjMyODEwNy0xNjNmLTQ2MDYtOWQ0NC1kYjNjYWI5YWRhMzQiLCJ6ZG4iOiI3MGYwZThiMXRyaWFsIiwic2VydmljZWluc3RhbmNlaWQiOiIyMWFmZTM4ZC1hZThiLTRkNmYtOTQxNC1lMzUyODUzZGRmMGUifSwic3ViIjoic2ItMjFhZmUzOGQtYWU4Yi00ZDZmLTk0MTQtZTM1Mjg1M2RkZjBlIWIxODUzNzR8YWxtLXRzLWJhY2tlbmQhYjE2MDMiLCJhdXRob3JpdGllcyI6WyJ1YWEucmVzb3VyY2UiLCJhbG0tdHMtYmFja2VuZCFiMTYwMy5zZXJ2aWNlIl0sInNjb3BlIjpbInVhYS5yZXNvdXJjZSIsImFsbS10cy1iYWNrZW5kIWIxNjAzLnNlcnZpY2UiXSwiY2xpZW50X2lkIjoic2ItMjFhZmUzOGQtYWU4Yi00ZDZmLTk0MTQtZTM1Mjg1M2RkZjBlIWIxODUzNzR8YWxtLXRzLWJhY2tlbmQhYjE2MDMiLCJjaWQiOiJzYi0yMWFmZTM4ZC1hZThiLTRkNmYtOTQxNC1lMzUyODUzZGRmMGUhYjE4NTM3NHxhbG0tdHMtYmFja2VuZCFiMTYwMyIsImF6cCI6InNiLTIxYWZlMzhkLWFlOGItNGQ2Zi05NDE0LWUzNTI4NTNkZGYwZSFiMTg1Mzc0fGFsbS10cy1iYWNrZW5kIWIxNjAzIiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsInJldl9zaWciOiI5YjBiOGVjOSIsImlhdCI6MTY5MTM0NTA1MCwiZXhwIjoxNjkxMzg4MjUwLCJpc3MiOiJodHRwczovLzcwZjBlOGIxdHJpYWwuYXV0aGVudGljYXRpb24udXMxMC5oYW5hLm9uZGVtYW5kLmNvbS9vYXV0aC90b2tlbiIsInppZCI6IjJmMzI4MTA3LTE2M2YtNDYwNi05ZDQ0LWRiM2NhYjlhZGEzNCIsImF1ZCI6WyJhbG0tdHMtYmFja2VuZCFiMTYwMyIsInVhYSIsInNiLTIxYWZlMzhkLWFlOGItNGQ2Zi05NDE0LWUzNTI4NTNkZGYwZSFiMTg1Mzc0fGFsbS10cy1iYWNrZW5kIWIxNjAzIl19.OExciDkruI3UCJHOJMqsBiAxx3wgWbZSyYrh8bs8A5EdaehCQ6vBu39lP8epKZJT9eVHJ-KELa9LAWoqZxdev_G4PcQEXSzfTSTIszY4jqghT6GU6hzOia6FW_ouFt7YjSleooNjBQiOkmkiZV9_tJoHEcFaRar621Y5M7RTuZ2mCdAPCldRpew7XEIm9RS_RQFfEImeyRAzzJpUVxU01SILIwLOxTZ_06W-ugMe3Iuy1z1rebgWMnN04A1oyYLCr4cqpNOk_8Rb6RLdbrijx4WbEbAwLbuMker4tKAbcuPjePU5ZB58shSEgK7t7bm1gs4wtkPhP1wJKSVnYsz3wg" -F 'file=@${{ github.workspace }}/githcicd_0.0.1.mtar' )
           echo $TOKEN
           echo $BODY
    
